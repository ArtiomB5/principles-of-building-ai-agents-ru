# 11  
## MODEL CONTEXT PROTOCOL (MCP): ПОДКЛЮЧЕНИЕ АГЕНТОВ И ИНСТРУМЕНТОВ

LLM, как и люди, становятся гораздо мощнее, когда им дают инструменты. MCP предоставляет стандартный способ предоставления моделям доступа к инструментам.

### **Что такое MCP**

В ноябре 2024 года небольшая команда в Anthropic предложила MCP как протокол для решения реальной проблемы: у каждого поставщика ИИ и автора инструментов был свой собственный способ определения и вызова инструментов.

Вы можете думать о MCP как о порте USB-C для ИИ-приложений.

Это открытый протокол для подключения ИИ-агентов к инструментам, моделям и друг к другу. Думайте о нем как об универсальном адаптере: если ваш инструмент или агент «говорит» на MCP, он может подключиться к любой другой MCP-совместимой системе — независимо от того, кто ее построил или на каком языке она написана.

Но, как знает любой опытный инженер, сила любого протокола заключается в сети людей, которые его соблюдают.

Хотя изначально он был хорошо принят, только в марте MCP достиг критической массы, после того как gained популярность среди prominent, vocal сторонников, таких как генеральный директор Shopify Тоби Лютке.

В апреле OpenAI и Google Gemini announced, что будут поддерживать MCP, сделав его протоколом по умолчанию.

### **Примитивы MCP**

MCP имеет два базовых примитива: серверы и клиенты.

- **Серверы** оборачивают наборы MCP-инструментов. Они (и их базовые инструменты) могут быть написаны на любом языке и общаться с клиентами по HTTP.  
- **Клиенты**, такие как модели или агенты, могут запрашивать серверы, чтобы получить набор предоставляемых инструментов, а затем запросить у сервера выполнение инструмента и возврат ответа.  

Таким образом, MCP является стандартом для удаленного выполнения кода, подобно OpenAPI или RPC.

### **Экосистема MCP**

По мере того как MCP набирал обороты, к fray присоединилась куча людей.

- **Поставщики** как Stripe начали поставлять MCP-серверы для своей API-функциональности.  
- **Независимые разработчики** начали создавать MCP-серверы для нужной им функциональности, такой как использование браузера, и публиковать их на Github.  
- **Реестры** как Smithery, PulseMCP и mcp.run появились, чтобы каталогизировать растущую экосистему серверов (а также проверять качество и безопасность поставщиков).  
- **Фреймворки** как Mastra начали поставлять абстракции MCP-серверов и клиентов, чтобы отдельным разработчикам не пришлось заново реализовывать спецификации самим.

### **Когда использовать MCP**

Агентам, как и SaaS, часто требуется ряд базовых интеграций со сторонними сервисами (календарь, чат, электронная почта, веб). Если в вашем roadmap много такого рода функций, стоит посмотреть на создание MCP-клиента, который мог бы получать доступ к сторонним функциям.

И наоборот, если вы создаете инструмент, который хотите, чтобы использовали другие агенты, вам следует рассмотреть возможность поставки MCP-сервера.

### **Построение MCP-сервера и клиента**

Если вы хотите создавать MCP-серверы и предоставлять агенту доступ к ним, вот как вы можете это сделать на TypeScript с Mastra:

```javascript
// -- weatherTool.ts --
import { defineTool } from "@mastra/core/tool";

export const weatherTool = defineTool({
    name: "weatherTool",
    description: "Get the current weather for a city.",
    parameters: {
        city: { type: "string", description: "City name" },
    },
    async execute({ city }) {
        // Dummy implementation
        return `The weather in \${city} is sunny!`;
    },
});

// -- weather-server.ts --
import { MCPServer } from "@mastra/mcp";
import { weatherTool } from "../weatherTool";

const server = new MCPServer({
    name: "Weather Server",
    version: "1.0.0",
    tools: { weatherTool },
});

await server.startStdio();

// -- agent.ts --
import { MCPClient } from "@mastra/mcp";
import { Agent } from "@mastra/core/agent";
import { openai } from "@ai-sdk/openai";

const mcp = new MCPClient({
    servers: {
        weather: {
            command: "npx",
            args: ["tsx", "weather-server.ts"],
        },
    },
    timeout: 30000,
});

const agent = new Agent({
    name: "Weather Agent",
    instructions: "You can answer weather questions using the weather tool.",
    model: openai("gpt-4"),
    tools: await mcp.getTools(),
});
```

И наоборот, если вы хотите создать клиент с доступом к другим MCP-серверам, вот как вы бы это сделали:

```javascript
import { MCPClient, MCPServer } from "@mastra/mcp";

// Step 1: Create an MCP client that connects to other MCP servers
const mcp = new MCPClient({
    servers: {
        weather: {
            // Connect to a remote MCP server via HTTP/SSE
            url: new URL("http://localhost:1234/sse"),
        },
        stocks: {
            // Or connect to a local MCP server via stdio
            command: "npx",
            args: ["tsx", "stock-server.ts"],
        },
    },
    timeout: 30000,
});

// Step 2: Expose all tools from the connected MCP servers via a new MCPServer
const server = new MCPServer({
    name: "Proxy MCP Server",
    version: "1.0.0",
    tools: await mcp.getTools(), // Aggregate tools from all connected servers
});

// Step 3: Start the proxy MCP server (stdio)
await server.startStdio();
```

### **Что дальше для MCP**

MCP как протокол технически впечатляет, но экосистема все еще работает над решением нескольких проблем:

- **Во-первых, обнаружение.** Не существует централизованного или стандартизированного способа поиска MCP-инструментов. Хотя появились различные реестры, это создало свою собственную фрагментацию.  
  В апреле мы somewhat в шутку построили первый Реестр Реестров MCP, но Anthropic actually работает над мета-реестром.  
- **Во-вторых, качество.** Пока нет эквивалента (пока) системе оценки пакетов NPM или бейджей проверки. Тем не менее, реестры (которые быстро привлекли венчурное финансирование) усердно работают над этим.  
- **В-третьих, конфигурация.** Каждый поставщик имеет свою собственную схему конфигурации и API. Спецификация MCP длинная, и клиенты не всегда полностью их реализуют.

### **Заключение**

Вы могли бы легко потратить выходные на отладку subtle различий между тем, как Cursor и Windsurf реализовали свои MCP-клиенты (и мы это сделали).

Есть alpha в экспериментировании с MCP, но вам, вероятно, не стоит создавать свою собственную реализацию, по крайней мере, не сейчас. Ищите хороший фреймворк или библиотеку на вашем языке.